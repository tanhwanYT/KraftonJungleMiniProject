<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>메인페이지 - Jungle Food</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Anton&family=Noto+Serif+KR:wght@200..900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Flask의 static 폴더를 쓰는 경우 -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
  <!-- 정적 경로를 아직 안 옮기셨다면 위 줄 대신 원래 경로 유지: <link rel="stylesheet" href="main.css"> -->
 <style>
   .side-auth {
     position: fixed;
     right: 24px;
     top: 50%;
     transform: translateY(-50%);
     display: flex;
     flex-direction: column;
     gap: 10px;
     z-index: 1000;
   }
   .side-auth .btn {
     display: inline-block;
     padding: 10px 16px;
     background: #37b43dff;
     color: #fff;
     border-radius: 8px;
     text-decoration: none;
     font-weight: 600;
     box-shadow: 0 2px 8px rgba(0, 0, 0, 1);
     text-align: center;
   }
   .side-auth .btn:hover { background:#53dd5c; color:#000; }
   .side-auth .btn.outline {
     background: transparent;
     color: #ffffffff;
     border: 2px solid #113f13;
   }
   .side-auth .btn.outline:hover { background:#113f13; color:#fff; }
</style>
</head>
<body>
  <header>
    <button class="write-btn">글쓰기</button>
    <h1>Jungle Food</h1>
    <div class="search-box">
      <input type="text" placeholder="검색어를 입력하세요">
      <i class="fa fa-search search-icon"></i>
    </div>
  </header>

  <nav class="category-nav">
    <a href="../place/Cafateria.html"><button>식당</button></a>
    <a href="../place/Outside.html"><button>외식</button></a>
    <a href="../place/Delivery.html"><button>배달</button></a>
  </nav>

  <main>
    <section class="latest-posts">
      <h2>최신글</h2>
      <ul id="post-list"></ul>
    </section>

    <!-- ✅ 로그인 여부에 따라 표시 분기 -->
  
    <script>
      window.addEventListener("DOMContentLoaded", () => {
        let posts = JSON.parse(localStorage.getItem("posts")) || [];
        const postList = document.getElementById("post-list");
    
        postList.innerHTML = "";
        posts.forEach((post, index) => {
          const li = document.createElement("li");
          li.textContent = post.title;
          li.onclick = () => {
            // 상세 페이지에 어떤 글을 열지 저장
            localStorage.setItem("currentPost", index);
            location.href = "PostView.html";
          };
          postList.appendChild(li);
        });
      });
    </script>
{% if user %}
  <aside class="user-container">
    <div class="user-box">
      <h3>회원정보</h3>
      <p>아이디: <span id="userId">{{ user.username }}</span></p>

      <!-- GET으로 /logout 이동 - danger 스타일 적용 -->
      <a class="btn danger" href="{{ url_for('logout') }}">로그아웃</a>

      <!-- POST로 회원탈퇴: 삭제는 반드시 POST -->
      <form method="post"
            action="{{ url_for('delete_account') }}"
            onsubmit="return confirm('정말 탈퇴하시겠습니까? 이 작업은 되돌릴 수 없습니다.');"
            style="margin-top:8px">
        <button type="submit" class="btn danger">회원탈퇴</button>
      </form>
    </div>
  </aside>
{% else %}
  <!-- 비로그인 상태: 우측에 로그인/회원가입 버튼 표시 -->
  <div class="side-auth">
    <a class="btn" href="{{ url_for('login_page') }}">로그인</a>
    <a class="btn outline" href="{{ url_for('register_page') }}">회원가입</a>
  </div>
{% endif %}
  </main>

  <!-- Flask static 사용 -->
  <script src="{{ url_for('static', filename='js/main_new.js') }}" defer></script>
  <!-- 정적 경로를 아직 안 옮기셨다면 위 줄 대신 원래 경로 유지: <script src="/miniproject/main_new/main_new.js" defer></script> -->
</body>
</html>
